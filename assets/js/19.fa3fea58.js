(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{295:function(a,s,t){"use strict";t.r(s);var e=t(10),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"mysql主从备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql主从备份"}},[a._v("#")]),a._v(" MySQL主从备份")]),a._v(" "),s("h3",{attrs:{id:"通过日志备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过日志备份"}},[a._v("#")]),a._v(" 通过日志备份")]),a._v(" "),s("h4",{attrs:{id:"主库配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主库配置"}},[a._v("#")]),a._v(" 主库配置")]),a._v(" "),s("p",[a._v("my.ini配置文件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[mysqld]\n#server_id不能和从库一样\nserver_id= 2\n#log-bin包含路径和文件名\nlog-bin=/path-to-log/mysql-bin\n")])])]),s("p",[a._v("重启数据库")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("net stop mysql\nnet start mysql\n")])])]),s("p",[a._v("登录主数据库，查询bin-log是否打开")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> show variables like '%log_bin%';\n")])])]),s("p",[a._v("建立用于主从复制的账号")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> CREATE USER 'repl'@'%' IDENTIFIED BY 'password';\nmysql> GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%' WITH GRANT OPTION;\nmysql> flush privileges;\n")])])]),s("p",[a._v("查看账号")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> select user,host,plugin from user;\n")])])]),s("h4",{attrs:{id:"从库配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从库配置"}},[a._v("#")]),a._v(" 从库配置")]),a._v(" "),s("p",[a._v("设置server-id并关闭binlog功能")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("server_id=21\nskip-log-bin\n")])])]),s("p",[a._v("重启数据库")]),a._v(" "),s("h4",{attrs:{id:"已有数据备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#已有数据备份"}},[a._v("#")]),a._v(" 已有数据备份")]),a._v(" "),s("p",[a._v("可通过 mysqldump 备份日志坐标节点前的所有数据")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysqldump --all-databases --master-data > dbdump.db\n")])])]),s("h4",{attrs:{id:"主库日志文件与开始位置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主库日志文件与开始位置"}},[a._v("#")]),a._v(" 主库日志文件与开始位置")]),a._v(" "),s("p",[a._v("主库查询")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> show master status;\n")])])]),s("p",[a._v("从库配置主库连接信息、日志路径和位置")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> CHANGE MASTER TO\n    -> MASTER_HOST='localhost',\n    -> MASTER_PORT=3306,\n    -> MASTER_USER='repl',\n    -> MASTER_PASSWORD='xxxx',\n    -> MASTER_LOG_FILE='mysql-bin.000001',\n    -> MASTER_LOG_POS=1220;\n")])])]),s("p",[a._v("启动")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("start slave;\n")])])]),s("p",[a._v("查看slave进程状态")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("show slave status\\G\n")])])]),s("h4",{attrs:{id:"验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[a._v("#")]),a._v(" 验证")]),a._v(" "),s("p",[a._v("主库")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("create database test;\n")])])]),s("p",[a._v("从库")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("show database;\n")])])]),s("h3",{attrs:{id:"通过gtid备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过gtid备份"}},[a._v("#")]),a._v(" 通过GTID备份")]),a._v(" "),s("h2",{attrs:{id:"mysql备份方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql备份方式"}},[a._v("#")]),a._v(" MySQL备份方式")]),a._v(" "),s("h3",{attrs:{id:"navicat定时自动备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#navicat定时自动备份"}},[a._v("#")]),a._v(" navicat定时自动备份")]),a._v(" "),s("p",[a._v("步骤：")]),a._v(" "),s("ol",[s("li",[a._v("打开navicat自动运行")]),a._v(" "),s("li",[a._v("新建批处理作业")]),a._v(" "),s("li",[a._v("选择备份——数据库名称——可用工作")]),a._v(" "),s("li",[a._v("单击保存，输入文件名")]),a._v(" "),s("li",[a._v("配置触发器")]),a._v(" "),s("li",[a._v("输入任务描述")]),a._v(" "),s("li",[a._v("单击确定")])]),a._v(" "),s("p",[a._v("用户登录那块不用管，一般服务器也只有一个用户会登录，也一直是登录状态")]),a._v(" "),s("p",[a._v("本质上还是创建了一个windows任务计划程序，创建了之后无论navicat是否打开，都会定时触发任务")]),a._v(" "),s("p",[a._v("可通过修改系统时间进行测试")]),a._v(" "),s("p",[a._v("优点：相比于mysqldump，nb3体积相比于sql更小，因为在数据查询的同时进行了二进制压缩")]),a._v(" "),s("p",[a._v("缺点：还原速度稍低")]),a._v(" "),s("h3",{attrs:{id:"bat脚本-window定时任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bat脚本-window定时任务"}},[a._v("#")]),a._v(" bat脚本+window定时任务")]),a._v(" "),s("h4",{attrs:{id:"单个数据库备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单个数据库备份"}},[a._v("#")]),a._v(" 单个数据库备份")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('@echo off\nset "Ymd=%date:~,4%%date:~5,2%%date:~8,2%"\nset "Hms=%time:~0,2%%time:~3,2%%time:~6,2%"\nset "DateTime=%Ymd%%Hms%"\nset host=127.0.0.1\nset port=3306\nset username=your_username\nset password=your_password\nset dbname=test\nset backupfile=D:\\db_backup\\%dbname%-%Ymd%.sql\nset orderPath="E:\\Program Files x86\\MySQL8.0\\MySQL Server 8.0\\bin\\mysqldump.exe"\n%orderPath% -h%host% -P%port% -u%username% -p%password% --single-transaction --quick %dbname%>%backupfile%\n@echo on\n')])])]),s("p",[a._v("保存到txt文件，后缀名改为bat，要注意备份文件路径必须是存在的，mysqldump脚本路径正确")]),a._v(" "),s("p",[a._v("备份命令中使用单一事务和快速插入")]),a._v(" "),s("p",[a._v("创建定时任务：")]),a._v(" "),s("ol",[s("li",[a._v("打开任务计划程序")]),a._v(" "),s("li",[a._v("选中任务计划程序库")]),a._v(" "),s("li",[a._v("创建基本任务")]),a._v(" "),s("li",[a._v("输入名称、描述")]),a._v(" "),s("li",[a._v("配置可执行文件路径、配置执行时间")])]),a._v(" "),s("h4",{attrs:{id:"数据库批量备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库批量备份"}},[a._v("#")]),a._v(" 数据库批量备份")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('@echo off\n:: 允许使用循环变量\nsetlocal enabledelayedexpansion\n\n:: 构造日期字符串\nset "Ymd=%date:~,4%%date:~5,2%%date:~8,2%"\nset "Hms=%time:~0,2%%time:~3,2%%time:~6,2%"\nset "DateTime=%Ymd%%Hms%"\n:: 数据库连接参数\nset host=127.0.0.1\nset port=3306\nset username=your_username\nset password=your_password\n:: 备份文件地址\nset "backupPath=D:\\db_backup\\%Ymd%"\nif not exist "%backupPath%" ( mkdir "%backupPath%")\nset orderPath="E:\\Program Files x86\\MySQL8.0\\MySQL Server 8.0\\bin\\mysqldump.exe"\n:: 数据库列表\nset databases=test;fengnan2021;huanghua2020\n\n:: 循环备份每个数据库\nfor %%i in (%databases%) do (\n    set backupfile=%backupPath%\\%%i-%DateTime%.sql\n    %orderPath% -h%host% -P%port% -u%username% -p%password% --single-transaction --quick %%i > "!backupfile!"\n)\nendlocal\n@echo on\n')])])]),s("h3",{attrs:{id:"备份时操作数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份时操作数据库"}},[a._v("#")]),a._v(" 备份时操作数据库")]),a._v(" "),s("ol",[s("li",[a._v("navicat备份时可以正常对数据进行增删改查，执行备份时是以表的顺序依次备份")]),a._v(" "),s("li",[a._v("执行mysqldump时，执行脚本添加–single-transaction --quick 属性，运行脚本时可以正常操作数据库，没加就不行")])])])}),[],!1,null,null,null);s.default=r.exports}}]);