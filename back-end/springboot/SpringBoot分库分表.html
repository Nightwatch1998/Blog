<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringBoot分库分表 | NightWatch</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/images/favicon.png">
    <meta name="description" content="编程，从入门到入土">
    
    <link rel="preload" href="/assets/css/0.styles.34aacdd0.css" as="style"><link rel="preload" href="/assets/js/app.3cfca620.js" as="script"><link rel="preload" href="/assets/js/2.994b757b.js" as="script"><link rel="preload" href="/assets/js/27.a310b475.js" as="script"><link rel="prefetch" href="/assets/js/10.b0dc23ab.js"><link rel="prefetch" href="/assets/js/11.a54da59e.js"><link rel="prefetch" href="/assets/js/12.ad25fb77.js"><link rel="prefetch" href="/assets/js/13.4106a679.js"><link rel="prefetch" href="/assets/js/14.83569b2f.js"><link rel="prefetch" href="/assets/js/15.d9426698.js"><link rel="prefetch" href="/assets/js/16.0ea418d9.js"><link rel="prefetch" href="/assets/js/17.93130a54.js"><link rel="prefetch" href="/assets/js/18.793eab1a.js"><link rel="prefetch" href="/assets/js/19.8ce14e6a.js"><link rel="prefetch" href="/assets/js/20.f5c4c435.js"><link rel="prefetch" href="/assets/js/21.448e3faa.js"><link rel="prefetch" href="/assets/js/22.c770b4a9.js"><link rel="prefetch" href="/assets/js/23.4bf911cc.js"><link rel="prefetch" href="/assets/js/24.415d2520.js"><link rel="prefetch" href="/assets/js/25.460a3daf.js"><link rel="prefetch" href="/assets/js/26.da97e4f0.js"><link rel="prefetch" href="/assets/js/28.80ab6835.js"><link rel="prefetch" href="/assets/js/29.c50def65.js"><link rel="prefetch" href="/assets/js/3.821b84c1.js"><link rel="prefetch" href="/assets/js/30.14e8903d.js"><link rel="prefetch" href="/assets/js/31.51574d37.js"><link rel="prefetch" href="/assets/js/32.66bdf70f.js"><link rel="prefetch" href="/assets/js/33.8fa7e647.js"><link rel="prefetch" href="/assets/js/34.768dbfc4.js"><link rel="prefetch" href="/assets/js/35.48823adf.js"><link rel="prefetch" href="/assets/js/36.1388fb52.js"><link rel="prefetch" href="/assets/js/37.b748547d.js"><link rel="prefetch" href="/assets/js/38.20bdb8ee.js"><link rel="prefetch" href="/assets/js/39.d54b7419.js"><link rel="prefetch" href="/assets/js/4.c69c5b0e.js"><link rel="prefetch" href="/assets/js/40.8f4a1d86.js"><link rel="prefetch" href="/assets/js/41.da77d0db.js"><link rel="prefetch" href="/assets/js/42.dedc8b43.js"><link rel="prefetch" href="/assets/js/43.ef384c64.js"><link rel="prefetch" href="/assets/js/44.e4b30413.js"><link rel="prefetch" href="/assets/js/45.b314166d.js"><link rel="prefetch" href="/assets/js/46.b6c59fe3.js"><link rel="prefetch" href="/assets/js/47.500d3a27.js"><link rel="prefetch" href="/assets/js/48.3f6c70dc.js"><link rel="prefetch" href="/assets/js/49.d4c1c038.js"><link rel="prefetch" href="/assets/js/5.4dc8d661.js"><link rel="prefetch" href="/assets/js/50.0bd61904.js"><link rel="prefetch" href="/assets/js/51.bf2a0072.js"><link rel="prefetch" href="/assets/js/52.debf6f7f.js"><link rel="prefetch" href="/assets/js/53.2556bfed.js"><link rel="prefetch" href="/assets/js/54.62f1e0a2.js"><link rel="prefetch" href="/assets/js/55.e02f0353.js"><link rel="prefetch" href="/assets/js/56.09f98471.js"><link rel="prefetch" href="/assets/js/57.093d70eb.js"><link rel="prefetch" href="/assets/js/58.0bafa8cd.js"><link rel="prefetch" href="/assets/js/59.50009625.js"><link rel="prefetch" href="/assets/js/6.88d03338.js"><link rel="prefetch" href="/assets/js/60.b32ef536.js"><link rel="prefetch" href="/assets/js/61.6d7b005a.js"><link rel="prefetch" href="/assets/js/62.7fcaa38f.js"><link rel="prefetch" href="/assets/js/63.dcd740ce.js"><link rel="prefetch" href="/assets/js/64.4a68c659.js"><link rel="prefetch" href="/assets/js/65.a80bbe8f.js"><link rel="prefetch" href="/assets/js/66.ea9eda8d.js"><link rel="prefetch" href="/assets/js/67.6afaec5e.js"><link rel="prefetch" href="/assets/js/68.4a7e9701.js"><link rel="prefetch" href="/assets/js/69.1789c728.js"><link rel="prefetch" href="/assets/js/7.9de3ff65.js"><link rel="prefetch" href="/assets/js/70.eee0b0c0.js"><link rel="prefetch" href="/assets/js/71.7109391b.js"><link rel="prefetch" href="/assets/js/72.d0c21069.js"><link rel="prefetch" href="/assets/js/73.94539fdc.js"><link rel="prefetch" href="/assets/js/74.05c74661.js"><link rel="prefetch" href="/assets/js/75.a833783d.js"><link rel="prefetch" href="/assets/js/76.620732f5.js"><link rel="prefetch" href="/assets/js/77.f4431347.js"><link rel="prefetch" href="/assets/js/78.85cb44dd.js"><link rel="prefetch" href="/assets/js/79.208ffa71.js"><link rel="prefetch" href="/assets/js/8.8c1df6e1.js"><link rel="prefetch" href="/assets/js/80.18e90e48.js"><link rel="prefetch" href="/assets/js/81.bc070c53.js"><link rel="prefetch" href="/assets/js/82.50cf78a8.js"><link rel="prefetch" href="/assets/js/83.d8a036a9.js"><link rel="prefetch" href="/assets/js/84.1342619d.js"><link rel="prefetch" href="/assets/js/85.eae3bbfa.js"><link rel="prefetch" href="/assets/js/86.84ef052d.js"><link rel="prefetch" href="/assets/js/87.2f6bb44d.js"><link rel="prefetch" href="/assets/js/88.8f49293a.js"><link rel="prefetch" href="/assets/js/89.887accbd.js"><link rel="prefetch" href="/assets/js/9.6db7ff72.js"><link rel="prefetch" href="/assets/js/90.3bde9a23.js"><link rel="prefetch" href="/assets/js/91.cc6355fa.js"><link rel="prefetch" href="/assets/js/92.b06f766c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34aacdd0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NightWatch</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/Basic/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/front-end/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/front-end/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/front-end/前端工程化/" class="nav-link">
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/front-end/性能优化/" class="nav-link">
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/front-end/数据格式/" class="nav-link">
  数据格式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端开发" class="dropdown-title"><span class="title">后端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端开发" class="mobile-dropdown-title"><span class="title">后端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/environment/" class="nav-link">
  环境配置
</a></li><li class="dropdown-item"><!----> <a href="/back-end/mysql/" class="nav-link">
  MySQL数据库
</a></li><li class="dropdown-item"><!----> <a href="/back-end/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/back-end/springboot/" class="nav-link router-link-active">
  SpringBoot
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GIS开发" class="dropdown-title"><span class="title">GIS开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="GIS开发" class="mobile-dropdown-title"><span class="title">GIS开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gis/GIS原理/" class="nav-link">
  GIS原理
</a></li><li class="dropdown-item"><!----> <a href="/gis/WebGIS/" class="nav-link">
  WebGIS开发
</a></li><li class="dropdown-item"><!----> <a href="/gis/地图学/" class="nav-link">
  地图学
</a></li><li class="dropdown-item"><!----> <a href="/gis/数据库/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/gis/tools/" class="nav-link">
  GIS工具
</a></li></ul></div></div><div class="nav-item"><a href="/rong/" class="nav-link">
  Rong
</a></div><div class="nav-item"><a href="/others/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/test/1.html" class="nav-link">
  测试
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/Basic/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/front-end/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/front-end/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/front-end/前端工程化/" class="nav-link">
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/front-end/性能优化/" class="nav-link">
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/front-end/数据格式/" class="nav-link">
  数据格式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端开发" class="dropdown-title"><span class="title">后端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端开发" class="mobile-dropdown-title"><span class="title">后端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/environment/" class="nav-link">
  环境配置
</a></li><li class="dropdown-item"><!----> <a href="/back-end/mysql/" class="nav-link">
  MySQL数据库
</a></li><li class="dropdown-item"><!----> <a href="/back-end/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/back-end/springboot/" class="nav-link router-link-active">
  SpringBoot
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GIS开发" class="dropdown-title"><span class="title">GIS开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="GIS开发" class="mobile-dropdown-title"><span class="title">GIS开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gis/GIS原理/" class="nav-link">
  GIS原理
</a></li><li class="dropdown-item"><!----> <a href="/gis/WebGIS/" class="nav-link">
  WebGIS开发
</a></li><li class="dropdown-item"><!----> <a href="/gis/地图学/" class="nav-link">
  地图学
</a></li><li class="dropdown-item"><!----> <a href="/gis/数据库/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/gis/tools/" class="nav-link">
  GIS工具
</a></li></ul></div></div><div class="nav-item"><a href="/rong/" class="nav-link">
  Rong
</a></div><div class="nav-item"><a href="/others/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/test/1.html" class="nav-link">
  测试
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Springboot</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/back-end/springboot/" aria-current="page" class="sidebar-link">♥SpringBoot家族♥</a></li><li><a href="/back-end/springboot/Spring Security教程.html" class="sidebar-link">Spring Security 知识总结</a></li><li><a href="/back-end/springboot/SpringBoot分库分表.html" class="active sidebar-link">SpringBoot分库分表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#shardingjdbc基于mybatis单库分表" class="sidebar-link">ShardingJDBC基于Mybatis单库分表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#引入依赖" class="sidebar-link">引入依赖</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#yml配置" class="sidebar-link">yml配置</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#注意事项" class="sidebar-link">注意事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#shardingjdbc基于jpa单库分表" class="sidebar-link">ShardingJDBC基于JPA单库分表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#引入依赖-2" class="sidebar-link">引入依赖</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#yml配置-2" class="sidebar-link">yml配置</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#注意事项-2" class="sidebar-link">注意事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#shardingjsbd基于jpa读写分离" class="sidebar-link">ShardingJSBD基于jpa读写分离</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#读写分离介绍" class="sidebar-link">读写分离介绍</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#引入依赖-3" class="sidebar-link">引入依赖</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#yml配置-3" class="sidebar-link">yml配置</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#注意事项-3" class="sidebar-link">注意事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#shardingjdbc基于jpa的db隔离" class="sidebar-link">ShardingJDBC基于JPA的DB隔离</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#知识准备" class="sidebar-link">知识准备</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#yml配置-4" class="sidebar-link">yml配置</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/SpringBoot分库分表.html#使用" class="sidebar-link">使用</a></li></ul></li></ul></li><li><a href="/back-end/springboot/SpringBoot参数校验-文档.html" class="sidebar-link">SpringBoot 学习</a></li><li><a href="/back-end/springboot/SpringBoot应用部署.html" class="sidebar-link">SpringBoot应用部署</a></li><li><a href="/back-end/springboot/SpringBoot热更新.html" class="sidebar-link">SpringBoot热更新</a></li><li><a href="/back-end/springboot/SpringBoot连接MySQL.html" class="sidebar-link">Springboot 数据库连接</a></li><li><a href="/back-end/springboot/SpringBoot连接Redis.html" class="sidebar-link">SpringBoot连接Redis</a></li><li><a href="/back-end/springboot/SpringBoot集成文件.html" class="sidebar-link">SpringBoot集成文件</a></li><li><a href="/back-end/springboot/Springboot连接池.html" class="sidebar-link">Springboot数据库连接池</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="springboot分库分表"><a href="#springboot分库分表" class="header-anchor">#</a> SpringBoot分库分表</h1> <h2 id="shardingjdbc基于mybatis单库分表"><a href="#shardingjdbc基于mybatis单库分表" class="header-anchor">#</a> ShardingJDBC基于Mybatis单库分表</h2> <h3 id="引入依赖"><a href="#引入依赖" class="header-anchor">#</a> 引入依赖</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.pagehelper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>pagehelper-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="yml配置"><a href="#yml配置" class="header-anchor">#</a> yml配置</h3> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> ds  <span class="token comment"># 数据源名称，唯一标识</span>
      <span class="token key atrule">ds</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource  <span class="token comment"># 数据源类型</span>
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver <span class="token comment"># 驱动名称</span>
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_sharding<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">tb_user</span><span class="token punctuation">:</span>  <span class="token comment"># 要分库分表的名称</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> ds.tb_user_$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>0..1<span class="token punctuation">}</span> <span class="token comment"># 数据节点 tb_user_0 tb_user_1</span>
          <span class="token key atrule">table-strategy</span><span class="token punctuation">:</span> <span class="token comment"># 分表策略</span>
            <span class="token key atrule">inline</span><span class="token punctuation">:</span> <span class="token comment"># 内联方式</span>
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id <span class="token comment"># 切片的列</span>
              <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> tb_user_$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>id % 2<span class="token punctuation">}</span> <span class="token comment"># 奇数在tb_user_1 偶数在tb_user_0</span>
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span> <span class="token comment"># 主键生成策略</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id <span class="token comment"># 主键列名</span>
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span> <span class="token comment"># 工作节点为123</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
      <span class="token key atrule">binding-tables</span><span class="token punctuation">:</span> tb_user
      
  <span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
    <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> <span class="token comment">#实体对象包全限定名</span>
    <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
      <span class="token key atrule">cache-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">use-generated-keys</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">default-executor-type</span><span class="token punctuation">:</span> REUSE
      <span class="token key atrule">use-actual-param-name</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h3 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h3> <ol><li>数据分片后，原有的数据库自动增长ID以及ORM层框架的配置不能再使用</li> <li>使用SNOWFLAKE 雪花算法，64为LONG类型，所以需要设置相关字段为BIGINT</li> <li>注意项目中springboot、jdk的版本号</li></ol> <h2 id="shardingjdbc基于jpa单库分表"><a href="#shardingjdbc基于jpa单库分表" class="header-anchor">#</a> ShardingJDBC基于JPA单库分表</h2> <h3 id="引入依赖-2"><a href="#引入依赖-2" class="header-anchor">#</a> 引入依赖</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.wenhao<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jpa-spec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="yml配置-2"><a href="#yml配置-2" class="header-anchor">#</a> yml配置</h3> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># sharding部分配置和前文mybatis方式相同</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">open-in-view</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 每个请求处理完毕关闭数据库连接</span>
    <span class="token key atrule">generate-ddl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 一般在开发阶段使用，根据entity生成数据库的ddl</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 控制台不显示sql语句</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span> 
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">dialect</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQLDialect  <span class="token comment"># 数据库方言</span>
        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> 
        <span class="token key atrule">use-new-id-generator-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 新的主键映射策略</span>
</code></pre></div><h3 id="注意事项-2"><a href="#注意事项-2" class="header-anchor">#</a> 注意事项</h3> <ol><li>jpa方式要使用@Table标注表名  @Repository标注dao</li></ol> <h2 id="shardingjsbd基于jpa读写分离"><a href="#shardingjsbd基于jpa读写分离" class="header-anchor">#</a> ShardingJSBD基于jpa读写分离</h2> <h3 id="读写分离介绍"><a href="#读写分离介绍" class="header-anchor">#</a> 读写分离介绍</h3> <p>设计目标：让使用方像使用一个数据库一样使用主从数据库集群</p> <p>读写分离则是根据SQL语义的分析，将读操作和写操作分别路由至主库与从库。</p> <p>读写分离可以提升系统的吞吐量和可用性，但也带来了数据不一致的问题</p> <h3 id="引入依赖-3"><a href="#引入依赖-3" class="header-anchor">#</a> 引入依赖</h3> <div class="language-xml extra-class"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.wenhao<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jpa-spec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="yml配置-3"><a href="#yml配置-3" class="header-anchor">#</a> yml配置</h3> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> master<span class="token punctuation">,</span>slave0 <span class="token comment"># 定义多个数据源</span>
      <span class="token key atrule">master</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_sharding_master<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> test
        <span class="token key atrule">password</span><span class="token punctuation">:</span> test
      <span class="token key atrule">slave0</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_sharding_slave0<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> test
        <span class="token key atrule">password</span><span class="token punctuation">:</span> test
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>  <span class="token comment"># 分片</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">tb_user</span><span class="token punctuation">:</span>
          <span class="token key atrule">database-strategy</span><span class="token punctuation">:</span>
            <span class="token key atrule">inline</span><span class="token punctuation">:</span>
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id
              <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> master
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
 		<span class="token comment"># 其他表</span>
    <span class="token key atrule">master-slave</span><span class="token punctuation">:</span> <span class="token comment">#主从配置</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> ms
        <span class="token key atrule">load-balance-algorithm-type</span><span class="token punctuation">:</span> round_robin  <span class="token comment"># 负载均衡算法为轮询</span>
        <span class="token key atrule">master-data-source-name</span><span class="token punctuation">:</span> master <span class="token comment"># 主数据库名称</span>
        <span class="token key atrule">slave-data-source-names</span><span class="token punctuation">:</span> slave0 <span class="token comment"># 从数据库名称</span>
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">open-in-view</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">generate-ddl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">dialect</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQLDialect
        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">use-new-id-generator-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div><h3 id="注意事项-3"><a href="#注意事项-3" class="header-anchor">#</a> 注意事项</h3> <ol><li>主库和从库的数据同步不是shardingJDBC做的，需要自行同步</li> <li>查询操作会发生在从库，修改、添加，操作会发生在主库</li></ol> <p>原文链接  https://www.pdai.tech/md/spring/springboot/springboot-x-mysql-shardingjdbc-jpa-masterslave.html</p> <h2 id="shardingjdbc基于jpa的db隔离"><a href="#shardingjdbc基于jpa的db隔离" class="header-anchor">#</a> ShardingJDBC基于JPA的DB隔离</h2> <h3 id="知识准备"><a href="#知识准备" class="header-anchor">#</a> 知识准备</h3> <ol><li><p>逻辑表：水平拆分的数据库的相同逻辑和数据结构表的<strong>总称</strong>。例如订单数据有10张表，分别是t_order_0到t_order_9，逻辑表名为t_order</p></li> <li><p>真实表：分片数据库中真实存在的物理表，t_order_0到t_order_9</p></li> <li><p>数据节点： 数据源名称和数据表，例如ds_0.t_order_0</p></li> <li><p>绑定表：<strong>分片规则一致</strong>的主表和子表，如t_order和t_order_item，均按照order_id分片</p> <ul><li>绑定表之间的多表关联查询不会出现笛卡尔积</li></ul></li> <li><p>广播表： 分布式计算中，将小表的副本发送到集群的每个节点，以便提高访问效率。</p></li> <li><p>分片键：用于分片的数据库字段</p></li> <li><p>分片算法：精确分片算法（单字段）、范围分片算法、复合分片算法（多字段）、Hint分片算法</p></li> <li><p>分片策略：标准分片策略、复合分片策略、行表达式分片策略（groovy表达式）、Hint分片策略</p></li></ol> <h3 id="yml配置-4"><a href="#yml配置-4" class="header-anchor">#</a> yml配置</h3> <div class="language-yml extra-class"><pre class="language-yml"><code>  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>a<span class="token punctuation">,</span>tenant<span class="token punctuation">-</span>b
      <span class="token key atrule">tenant-a</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_tenant_a<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
      <span class="token key atrule">tenant-b</span><span class="token punctuation">:</span>
			<span class="token punctuation">...</span>
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token key atrule">default-database-strategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">hint</span><span class="token punctuation">:</span>
          <span class="token key atrule">algorithm-class-name</span><span class="token punctuation">:</span> 
          	<span class="token comment"># hint算法全限定类名</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">tb_user</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
			<span class="token punctuation">...</span>
        <span class="token key atrule">tb_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
			<span class="token punctuation">...</span>
        <span class="token key atrule">tb_user_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
			<span class="token punctuation">...</span>
      <span class="token key atrule">binding-tables</span><span class="token punctuation">:</span> tb_user<span class="token punctuation">,</span>tb_role<span class="token punctuation">,</span>tb_user_role
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TenantDatasourceAspect</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 定义切点.
     */</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* tech.pdai.springboot.shardingjdbc.jpa.tenant.dbhint.dao.*.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">useTenantDSPointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// no impl</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 前置逻辑</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;useTenantDSPointCut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doDs0Before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HintManager</span> hintManager <span class="token operator">=</span> <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 实际环境将client信息放在xxxContext中（由ThreadLocal承接），并通过client-id来获取tenant.</span>
        <span class="token comment">// 这里为了方便演示，只是使用了tenant-a</span>
        hintManager<span class="token punctuation">.</span><span class="token function">setDatabaseShardingValue</span><span class="token punctuation">(</span><span class="token string">&quot;tenant-a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 后置逻辑</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;useTenantDSPointCut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doDs0after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/11/2024, 6:05:31 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/back-end/springboot/Spring Security教程.html" class="prev">
        Spring Security 知识总结
      </a></span> <span class="next"><a href="/back-end/springboot/SpringBoot参数校验-文档.html">
        SpringBoot 学习
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.3cfca620.js" defer></script><script src="/assets/js/2.994b757b.js" defer></script><script src="/assets/js/27.a310b475.js" defer></script>
  </body>
</html>
